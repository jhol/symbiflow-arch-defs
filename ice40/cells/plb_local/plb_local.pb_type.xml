<!-- set: ai sw=1 ts=1 sta et -->
<!-- A diagram for the iCE40 PLB "Logic Cell" is shown in;
      http://www.latticesemi.com/~/media/LatticeSemi/Documents/DataSheets/iCE/iCE40LPHXFamilyDataSheet.pdf
      Architecture iCE40 LP/HX Family Data Sheet
       * Figure 2-2. PLB Block Diagram

     It is 8 x (SB_CARRY + SB_LUT4 + FF)
  -->
<pb_type name="PLB_LOCAL" num_pb="1" xmlns:xi="http://www.w3.org/2001/XInclude">
 <!-- SB_LUT4 inputs -->
 <input  name="I0"     num_pins="4" equivalent="false"/>
 <input  name="I1"     num_pins="4" equivalent="false"/>
 <input  name="I2"     num_pins="4" equivalent="false"/>
 <input  name="I3"     num_pins="4" equivalent="false"/>
 <input  name="I4"     num_pins="4" equivalent="false"/>
 <input  name="I5"     num_pins="4" equivalent="false"/>
 <input  name="I6"     num_pins="4" equivalent="false"/>
 <input  name="I7"     num_pins="4" equivalent="false"/>

 <!-- D flip-flop outputs -->
 <output name="O0"     num_pins="1" equivalent="false"/>
 <output name="O1"     num_pins="1" equivalent="false"/>
 <output name="O2"     num_pins="1" equivalent="false"/>
 <output name="O3"     num_pins="1" equivalent="false"/>
 <output name="O4"     num_pins="1" equivalent="false"/>
 <output name="O5"     num_pins="1" equivalent="false"/>
 <output name="O6"     num_pins="1" equivalent="false"/>
 <output name="O7"     num_pins="1" equivalent="false"/>

 <output name="FCOUT0" num_pins="1" equivalent="false"/>
 <output name="FCOUT1" num_pins="1" equivalent="false"/>
 <output name="FCOUT2" num_pins="1" equivalent="false"/>
 <output name="FCOUT3" num_pins="1" equivalent="false"/>
 <output name="FCOUT4" num_pins="1" equivalent="false"/>
 <output name="FCOUT5" num_pins="1" equivalent="false"/>
 <output name="FCOUT6" num_pins="1" equivalent="false"/>
 <output name="FCOUT7" num_pins="1" equivalent="false"/>

 <!-- D flip-flop controls -->
 <clock  name="CLK"    num_pins="1" equivalent="false"/>
 <input  name="EN"     num_pins="1" equivalent="false"/>
 <input  name="SR"     num_pins="1" equivalent="false"/>

 <!-- Carry chain -->
 <input  name="FCIN"   num_pins="1" equivalent="false"/>
 <output name="FCOUT"  num_pins="1" equivalent="false"/>

 <mode name="vpr_ff">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/vpr_ff.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O VPR_FF.Q"   output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK" output="VPR_FF.clk"/>
    <direct name="LUT2FF"           input="LUT.O"            output="VPR_FF.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dff">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dff.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFF.Q"   output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK" output="SB_DFF.C"/>
    <direct name="LUT2FF"           input="LUT.O"            output="SB_DFF.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dffe">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dffe.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFFE.Q"  output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.EN"  input="BLK_IG-LUTFF.EN"  output="SB_DFFE.E"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK" output="SB_DFFE.C"/>
    <direct name="LUT2FF"           input="LUT.O"            output="SB_DFFE.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dffsr">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dffsr.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFFSR.Q" output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK" output="SB_DFFSR.C"/>
    <direct name="BLK_IG-LUTFF.SR"  input="BLK_IG-LUTFF.SR"  output="SB_DFFSR.R"/>
    <direct name="LUT2FF"           input="LUT.O"            output="SB_DFFSR.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dffr">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dffr.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFFR.Q"  output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK" output="SB_DFFR.C"/>
    <direct name="BLK_IG-LUTFF.SR"  input="BLK_IG-LUTFF.SR"  output="SB_DFFR.R"/>
    <direct name="LUT2FF"           input="LUT.O"            output="SB_DFFR.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dffss">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dffss.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFFSS.Q" output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK" output="SB_DFFSS.C"/>
    <direct name="BLK_IG-LUTFF.SR"  input="BLK_IG-LUTFF.SR"  output="SB_DFFSS.S"/>
    <direct name="LUT2FF"           input="LUT.O"            output="SB_DFFSS.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dffs">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dffs.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFFS.Q"  output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK" output="SB_DFFS.C"/>
    <direct name="BLK_IG-LUTFF.SR"  input="BLK_IG-LUTFF.SR"  output="SB_DFFS.S"/>
    <direct name="LUT2FF"           input="LUT.O"            output="SB_DFFS.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dffesr">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dffesr.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFFESR.Q" output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.EN"  input="BLK_IG-LUTFF.EN"   output="SB_DFFESR.E"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK"  output="SB_DFFESR.C"/>
    <direct name="BLK_IG-LUTFF.SR"  input="BLK_IG-LUTFF.SR"   output="SB_DFFESR.R"/>
    <direct name="LUT2FF"           input="LUT.O"             output="SB_DFFESR.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dffer">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dffer.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFFER.Q" output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.EN"  input="BLK_IG-LUTFF.EN"  output="SB_DFFER.E"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK" output="SB_DFFER.C"/>
    <direct name="BLK_IG-LUTFF.SR"  input="BLK_IG-LUTFF.SR"  output="SB_DFFER.R"/>
    <direct name="LUT2FF"           input="LUT.O"            output="SB_DFFER.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dffess">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dffess.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFFESS.Q" output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.EN"  input="BLK_IG-LUTFF.EN"   output="SB_DFFESS.E"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK"  output="SB_DFFESS.C"/>
    <direct name="BLK_IG-LUTFF.SR"  input="BLK_IG-LUTFF.SR"   output="SB_DFFESS.S"/>
    <direct name="LUT2FF"           input="LUT.O"             output="SB_DFFESS.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

 <mode name="dffes">
  <pb_type name="BLK_IG-LUTFF" num_pb="8">
   <xi:include href="../lutff/lutff.ports.xml" xpointer="xpointer(ports/child::node())"/>
   <xi:include href="../../primitives/sb_lut/sb_lut.pb_type.xml"/>
   <xi:include href="../../primitives/sb_ff/sb_dffes.pb_type.xml"/>
   <xi:include href="../../primitives/sb_carry/sb_carry.pb_type.xml"/>

   <interconnect>
    <xi:include href="../lutff/lutff.interconnect.xml" xpointer="xpointer(interconnect/child::node())"/>

    <mux    name="BLK_IG-LUTFF.O"   input="LUT.O SB_DFFES.Q" output="BLK_IG-LUTFF.O"/>
    <direct name="BLK_IG-LUTFF.EN"  input="BLK_IG-LUTFF.EN"  output="SB_DFFES.E"/>
    <direct name="BLK_IG-LUTFF.CLK" input="BLK_IG-LUTFF.CLK" output="SB_DFFES.C"/>
    <direct name="BLK_IG-LUTFF.SR"  input="BLK_IG-LUTFF.SR"  output="SB_DFFES.R"/>
    <direct name="LUT2FF"           input="LUT.O"            output="SB_DFFES.D"/>
   </interconnect>
  </pb_type>

  <xi:include href="plb_local.interconnect.xml"/>
 </mode>

</pb_type>
